<div class="formulario-container">
    <h1>Administrador de Promociones</h1>

        <div class="formulario">
            <div class="campo">
            <label>Nombre:</label>
            <input [(ngModel)]="nuevaPromo.nombre" placeholder="Nombre de promoci√≥n">
        </div>

        <div class="campo">
            <label>Tipo:</label>
            <div class="tipo-checkboxes">
                <label>
                    <input type="checkbox" [checked]="nuevaPromo.tipo === 1"
                            (change)="seleccionarTipo('1')">
                            Contrataci√≥n (1)
                </label>
                <label>
                    <input type="checkbox" [checked]="nuevaPromo.tipo === 2"
                            (change)="seleccionarTipo('2')">
                            Mensualidad (2)
                </label>
            </div>
        </div>

        <!-- Selector de aplicaci√≥n: Ciudades completas o Colonias espec√≠ficas -->
        <div class="campo">
            <label>Aplicar promoci√≥n por:</label>
            <div class="aplicacion-checkboxes">
                <label>
                    <input type="radio" name="aplicacion" value="ciudades" [(ngModel)]="tipoAplicacion" (change)="onTipoAplicacionChange()">
                    Ciudades completas (incluye todas sus colonias)
                </label>
                <label>
                    <input type="radio" name="aplicacion" value="colonias" [(ngModel)]="tipoAplicacion" (change)="onTipoAplicacionChange()">
                    Colonias espec√≠ficas
                </label>
            </div>
        </div>

        <!-- Selector de Ciudades (solo si se eligi√≥ aplicar por ciudades completas) -->
        <div class="campo" *ngIf="tipoAplicacion === 'ciudades'">
            <label>Seleccionar Ciudades:</label>
            <select [(ngModel)]="ciudadSeleccionada" (change)="onCiudadCompleteChange()" class="select-ciudad">
                <option value="">Selecciona una ciudad</option>
                <option *ngFor="let ciudad of ciudadesDisponibles" [value]="ciudad.name">{{ciudad.name}}</option>
            </select>
            <div class="box-elements" *ngIf="nuevaPromo.ciudadesIds.length > 0">
                <div class="box-container">
                    <div *ngFor="let ciudadId of nuevaPromo.ciudadesIds; let i = index" class="element">
                    <div class="content">
                        <p>{{getNombreCiudad(ciudadId)}} (todas sus colonias)</p>
                        <span class="button-sim" (click)="eliminarCiudad(i)">
                            <span class="x1"></span>
                            <span class="x2"></span>
                        </span>
                    </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Selector de Colonias (solo si se eligi√≥ aplicar por colonias espec√≠ficas) -->
        <div class="campo" *ngIf="tipoAplicacion === 'colonias'">
            <label>Seleccionar Colonias:</label>
            <select [(ngModel)]="coloniaSeleccionada" (change)="onColoniaEspecificaChange()" class="select-colonia">
                <option value="">Selecciona una colonia</option>
                <option *ngFor="let colonia of todasLasColonias" [value]="colonia.name">{{colonia.name}} ({{colonia.ciudadNombre}})</option>
            </select>
            <div class="box-elements" *ngIf="nuevaPromo.coloniasIds.length > 0">
                <div class="box-container">
                    <div *ngFor="let coloniaId of nuevaPromo.coloniasIds; let i = index" class="element">
                    <div class="content">
                        <p>{{getNombreColoniaCompleto(coloniaId)}}</p>
                        <span class="button-sim" (click)="eliminarColonia(i)">
                            <span class="x1"></span>
                            <span class="x2"></span>
                        </span>
                    </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="campo">
            <label>Alcance:</label>
            <div class="alcance-checkboxes">
                <label>
                    <input type="checkbox" [checked]="nuevaPromo.alcance === 'Nuevos suscriptores'"
                            (change)="seleccionarAlcance('Nuevos suscriptores')">
                            Nuevos suscriptores
                </label>
                <label>
                    <input type="checkbox" [checked]="nuevaPromo.alcance === 'Actuales y nuevos suscriptores'"
                            (change)="seleccionarAlcance('Actuales y nuevos suscriptores')">
                            Actuales y nuevos suscriptores
                </label>
            </div>
        </div>

        <div class="campo">
            <label>Precio/Porcentaje:</label>
            <input [(ngModel)]="nuevaPromo.precioPorcen" placeholder="Precio o % (0-1 para porcentaje)" type="number" step="0.01">
        </div>

        <div class="campo">
            <label>Duraci√≥n:</label>
            <input [(ngModel)]="nuevaPromo.duracion" placeholder="Meses" type="number">
        </div>

        <div class="campo">
            <label>Vigencia:</label>
            <input [(ngModel)]="nuevaPromo.vigencia" placeholder="Vigencia" type="date">
        </div>

        <button (click)="registrarPromo()">{{ editIndex !== null ? 'Actualizar' : 'Registrar' }}</button>
    </div>
</div>

<div class="table-container">
    <h1>Promociones Existentes</h1>
        <table>
        <thead>
            <tr>
            <th>Nombre</th><th>Tipo</th><th>Colonia</th><th>Ciudad</th>
            <th>Alcance</th><th>Descuento</th><th>Duraci√≥n</th><th>Vigencia</th><th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let promo of promociones; let i = index">
            <td>{{ promo.nombre }}</td>
            <td>{{ getTipoTexto(promo.tipo) }}</td>
            <td>{{ getColoniasNombres(promo) }}</td>
            <td>{{ getCiudadesNombres(promo) }}</td>
            <td>{{ getAlcanceTexto(promo.alcance) }}</td>
            <td>{{ promo.precioPorcen }}</td>
            <td>{{ promo.duracion }} meses</td>
            <td>{{ promo.vigencia | date:'short' }}</td>
            <td>
                <button (click)="editarPromo(i)">‚úèÔ∏è</button>
                <button (click)="eliminarPromo(i)">üóëÔ∏è</button>
            </td>
            </tr>
        </tbody>
        </table>
</div>
